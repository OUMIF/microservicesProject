import './polyfills.server.mjs';
import{G as g,u,v as f}from"./chunk-YWCID7DG.mjs";import{I as d,L as p,Q as a,w as c}from"./chunk-JR6AME7G.mjs";var n=class extends Error{};n.prototype.name="InvalidTokenError";function w(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function m(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return w(e)}catch{return atob(e)}}function s(o,e){if(typeof o!="string")throw new n("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,r=o.split(".")[t];if(typeof r!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let l;try{l=m(r)}catch(i){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${i.message})`)}try{return JSON.parse(l)}catch(i){throw new n(`Invalid token specified: invalid json for part #${t+1} (${i.message})`)}}var h=class o{constructor(e,t){this.http=e;this.router=t}apiUrl="https://localhost:5000/auth/login";login(e){return this.http.post(`${this.apiUrl}`,e,{withCredentials:!0,headers:new u({"Content-Type":"application/json"})}).pipe(c(t=>{throw console.error("Login error:",t),t}),d(t=>{t.token&&t.role&&(this.setToken(t.token),this.setRole(t.role))}))}setToken(e){typeof window<"u"&&window.localStorage&&localStorage.setItem("auth_token",e)}getToken(){return typeof window<"u"&&window.localStorage?localStorage.getItem("auth_token"):null}decodeToken(){let e=this.getToken();return e?(console.log(s(e)),s(e)):null}isLoggedIn(){return!!this.getToken()}logout(){typeof window<"u"&&window.localStorage&&localStorage.removeItem("auth_token"),this.router.navigate(["/accueil"])}setRole(e){typeof window<"u"&&window.localStorage&&localStorage.setItem("role",e)}getRole(){return this.decodeToken()?.role||null}isAdmin(){let e=this.getRole();return e?e.includes("Admin"):!1}isProfesseur(){let e=this.getRole();return e?e.includes("Professeur"):!1}isEtudiant(){let e=this.getRole();return e?e.includes("Etudiant"):!1}static \u0275fac=function(t){return new(t||o)(a(f),a(g))};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
