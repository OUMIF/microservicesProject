<div class="page-container">
    <app-sidebar (sidebarToggled)="onSidebarToggled($event)"></app-sidebar>
    
    <div class="content-frame" [class.collapsed]="sidebarCollapsed">
      <div class="login-container">
        
        <div class="welcome-container">
          <div class="welcome-text">
              <h1>Gestion des Comptes Étudiants</h1>
              <p>Créez, gérez et organisez les profils des étudiants pour un suivi clair et structuré de leur parcours académique.</p>
          </div>
          <div class="welcome-icon">
              <img src="assets/svg2.jpg" alt="Graduation cap" />
          </div>
      </div>
        
        <div class="search-filter-container">
          <div class="search-box">
            <input type="text" placeholder="Rechercher..." [(ngModel)]="searchQuery" (input)="updateTable()">
            <button class="search-button"><i class="fas fa-search"></i></button>
          </div>
          <div class="action-buttons">
            <button class="action-button create" (click)="showStudentForm = true; editMode = false">
              <i class="fas fa-user-plus"></i> Créer
            </button>
            <button class="filter-button" (click)="showFilterOptions = true">
              <i class="fas fa-filter"></i> Filtres
            </button>
            <button class="reset-button" (click)="resetFilters()">
              <i class="fas fa-sync-alt"></i> Réinitialiser
            </button>
            <button class="action-button import" (click)="generatePDF()">
              <i class="fas fa-file-import"></i> Exporter
            </button>
            <button class="delete-all-button" (click)="deleteAllSelected()">
              <i class="fas fa-trash"></i> Supprimer sélection
            </button>
          </div>
        </div>
  
        <div class="table-container">
          <table [ngClass]="getTableClasses()">
            <thead>
              <tr>
                  <!-- Ligne à modifier -->
                  <th *ngFor="let column of columns" 
                  (click)="column.key !== 'select' && column.key !== 'actions' ? sortBy(column.key) : null">
                  <span *ngIf="column.key === 'select'">
                    <input type="checkbox" [(ngModel)]="allSelected" (change)="toggleSelectAll()">
                  </span>
                  <span *ngIf="column.key !== 'select'">
                    {{ column.title }}
                    <span *ngIf="sortColumn === column.key" class="sort-icon">
                      {{ sortDirection === 'asc' ? '↑' : '↓' }}
                    </span>
                  </span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of pagedStudents">
                <td><input type="checkbox" [(ngModel)]="student.selected"></td>
                <td>
                  <div class="avatar-container">
                    <div *ngIf="student.isPhotoUrl" class="avatar-image-wrapper">
                      <img [src]="student.photo" alt="Photo" class="avatar-image">
                    </div>
                    <div *ngIf="!student.isPhotoUrl" 
                         class="avatar-initials" 
                         [ngClass]="getInitialBackgroundColor(student.photo)"
                         [title]="student.photo">
                      {{ student.photo.length > 2 ? student.photo.substring(0,2) : student.photo }}
                    </div>
                  </div>
                </td>
                <td>{{ student.apogee }}</td>
                <td>{{ student.cne }}</td>
                <td>{{ student.lastName }}</td>
                <td>{{ student.firstName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.birthPlace }}</td>
                <td>{{ student.birthDate | date:'dd/MM/yyyy' }}</td>
                <td>{{ student.program }}</td>
                <td>{{ student.studyYear }}</td>
                <td class="actions">
                  <button class="icon-button edit" (click)="openEditForm(student)">
                    <i class="fas fa-pencil-alt"></i>
                  </button>
                  <button class="icon-button delete" (click)="deleteStudent(student)">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
  
          <div class="pagination-container">
            <div class="pagination-controls">
              <button class="pagination-arrow" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button *ngFor="let page of getPageNumbers()" 
                      class="pagination-number" 
                      [class.active]="page === currentPage"
                      (click)="goToPage(page)">
                {{ page }}
              </button>
              <button class="pagination-arrow" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            
            <div class="pagination-info">
              <div class="items-per-page">
                <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                </select>
                Par page, Total {{ students.length }} éléments
              </div>
              
              <div class="go-to-page">
                Aller à
                <input type="number" [(ngModel)]="goToPageInput" min="1" [max]="totalPages">
                <button (click)="goToPage(goToPageInput)">OK</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
<!-- Modifier le modal de suppression existant par ceci -->
<div class="modal-overlay" *ngIf="showDeleteConfirmation">
  <div class="modal">
    <h3>Confirmation de suppression</h3>
    <p>Êtes-vous sûr de vouloir supprimer les étudiants sélectionnés ?</p>
    <div class="modal-actions">
      <button class="cancel" (click)="showDeleteConfirmation = false">Annuler</button>
      <button class="confirm" (click)="confirmDeleteAll()">Confirmer</button>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showFilterOptions">
  <div class="modal filter-modal">
    <h3>Filtres</h3>
    <div class="filter-content">
      <div class="filter-option">
        <label>Filière :</label>
        <select [(ngModel)]="selectedProgram">
          <option value="">Toutes</option>
          <option *ngFor="let program of programs" [value]="program">{{program}}</option>
        </select>
      </div>
    </div>
    <div class="modal-actions compact">
      <button class="cancel-btn" (click)="closeFilters()">Annuler</button>
      <button class="apply-btn" (click)="applyFilters()">Appliquer</button>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showStudentForm">
  <div class="modal">
    <h3>{{editMode ? 'Modifier' : 'Créer'}} un étudiant</h3>
    <form (ngSubmit)="submitStudentForm()">
      <div class="form-row">
        <div class="form-group">
          <label>Photo (URL/Initiales):</label>
          <input type="text" [(ngModel)]="currentStudent.photo" name="photo" required>
        </div>
        <div class="form-group">
          <label>CNE:</label>
          <input type="text" [(ngModel)]="currentStudent.cne" name="cne" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Nom:</label>
          <input type="text" [(ngModel)]="currentStudent.lastName" name="lastName" required>
        </div>
        <div class="form-group">
          <label>Prénom:</label>
          <input type="text" [(ngModel)]="currentStudent.firstName" name="firstName" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Email:</label>
          <input type="email" [(ngModel)]="currentStudent.email" name="email" required>
        </div>
        <div class="form-group">
          <label>Date de naissance:</label>
          <input type="date" [(ngModel)]="currentStudent.birthDate" name="birthDate" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Lieu de naissance:</label>
          <input type="text" [(ngModel)]="currentStudent.birthPlace" name="birthPlace" required>
        </div>
        <div class="form-group">
          <label>Filière:</label>
          <select [(ngModel)]="currentStudent.program" name="program" required>
            <option value="">Sélectionner...</option>
            <option *ngFor="let program of programs" [value]="program">{{program}}</option>
          </select>
        </div>
      </div>
      
      <div class="form-group single-row">
        <label>Année d'étude:</label>
        <select [(ngModel)]="currentStudent.studyYear" name="studyYear" required>
          <option value="">Sélectionner...</option>
          <option *ngFor="let year of studyYears" [value]="year">{{year}}</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button type="button" (click)="showStudentForm = false">Annuler</button>
        <button type="submit">{{editMode ? 'Modifier' : 'Créer'}}</button>
      </div>
    </form>
  </div>
</div>