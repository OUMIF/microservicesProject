<div class="page-container">
  <app-sidebar (sidebarToggled)="onSidebarToggled($event)"></app-sidebar>

  <div class="content-frame" [class.collapsed]="sidebarCollapsed">
    <div class="login-container">
      <h1 class="page-title">Gestion des Formations</h1>
      <div class="search-filter-container">
        <div class="search-box">
          <input type="text" placeholder="Rechercher...">
          <button class="search-button"><i class="fas fa-search"></i></button>
        </div>
        <div class="action-buttons">
          <button class="action-button create" (click)="openCreationForm()">
            <i class="fas fa-plus"></i> Créer une formation
          </button>         
        </div>
      </div>
  
      <div class="formations-grid">
        <div *ngFor="let formation of formations" class="formation-card">
          <div class="card-left">
            <div class="formation-image" [style.background-image]="'url(' + formation.imageUrl + ')'"></div>
            <div class="formation-info">
              <span class="formation-program" *ngIf="formation.filieres.length">{{ formation.filieres.join(', ') }}</span>
              <h3 class="formation-title">{{ formation.title }}</h3>
              <p class="formation-tagline">{{ formation.sujet }}</p>
              <div class="formation-description" [innerHTML]="formation.description"></div>
              <p class="formation-dates">{{ formation.programDates }}</p>
            </div>
          </div>
          
          <div class="card-right">
            <div class="professor-section">
            <h4>Responsables</h4>
            <div *ngFor="let prof of formation.professeurs" class="professor-info">
              <div class="professor-photo" [style.background-image]="'url(' + prof.photo + ')'"></div>
              <div class="professor-details">
                <p class="professor-name">{{ prof.name }}</p>
                <p class="professor-bio">{{ prof.description_prof }}</p>
              </div>
            </div>
          </div>
          
          <div class="card-actions">
            <button class="action-icon edit" (click)="editFormation(formation)">
              <i class="fas fa-pencil-alt"></i>
            </button>
            <button class="action-icon delete" (click)="deleteFormation(formation)">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showFormationForm">
    <div class="modal">
      <h3>{{ editMode ? 'Modifier' : 'Créer' }} une formation</h3>
      <form (ngSubmit)="submitFormationForm()">
        <!-- Ligne 1 -->
        <div class="form-row">
          <div class="form-group">
            <label>Titre de la formation:</label>
            <input type="text" [(ngModel)]="currentFormation.title" name="title" required>
          </div>
          <div class="form-group">
            <label>Sujet:</label>
            <input type="text" [(ngModel)]="currentFormation.sujet" name="sujet" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Image:</label>
            <div class="file-upload">
              <input type="file" id="formation-image" (change)="onFileSelected($event)" accept="image/*">
              <label for="formation-image" class="upload-button"></label>
              <span class="file-name" *ngIf="selectedFileName">{{ selectedFileName }}</span>
            </div>
          </div>

          <div class="form-group">
            <label>Dates du programme:</label>
            <input type="text" [(ngModel)]="currentFormation.programDates" name="programDates" required>
          </div>
        </div>

        <!-- Ligne 3 -->
        <div class="form-row">
          <div class="form-group">
            <label>Description:</label>
            <textarea [(ngModel)]="currentFormation.description" name="description" rows="3" required></textarea>
          </div>
        </div>

        <!-- Ligne 4 - Filières -->
        <div class="form-row">
          <div class="form-group">
            <label>Filière(s):</label>
            <div class="custom-multiselect">
              <div class="select-box" (click)="toggleDropdown('filieres')">
                <div class="selected-items">
                  <span class="selected-item" *ngFor="let filiere of currentFormation.filieres">
                    {{ filiere }}
                    <span class="remove-item" (click)="removeItem($event, filiere, 'filieres')">×</span>
                  </span>
                  <span class="placeholder" *ngIf="!currentFormation.filieres.length">Sélectionner...</span>
                </div>
                <div class="dropdown-arrow">▼</div>
              </div>
              <div class="options-container" *ngIf="showFilieresDropdown">
                <div class="option" *ngFor="let filiere of availableFilieres">
                  <label>
                    <input type="checkbox" 
                      [checked]="currentFormation.filieres.includes(filiere)"
                      (change)="toggleSelection(filiere, 'filieres')">
                    {{ filiere }}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ligne 5 - Professeurs -->
        <div class="form-row">
          <div class="form-group">
            <label>Professeur(s):</label>
            <div class="custom-multiselect">
              <div class="select-box" (click)="toggleDropdown('professeurs')">
                <div class="selected-items">
                  <span class="selected-item" *ngFor="let prof of currentFormation.professeurs">
                    {{ prof.name }}
                    <span class="remove-item" (click)="removeItem($event, prof, 'professeurs')">×</span>
                  </span>
                  <span class="placeholder" *ngIf="!currentFormation.professeurs.length">Sélectionner...</span>
                </div>
                <div class="dropdown-arrow">▼</div>
              </div>
              <div class="options-container" *ngIf="showProfesseursDropdown">
                <div class="option" *ngFor="let prof of availableProfesseurs">
                  <label>
                    <input type="checkbox" 
                      [checked]="isProfessorSelected(prof)"
                      (change)="toggleProfessorSelection(prof)">
                    <div class="professor-info">
                      <img [src]="prof.photo" class="professor-thumb">
                      <div>
                        <div><strong>{{ prof.name }}</strong></div>
                        <div class="professor-desc">{{ prof.description_prof }}</div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" (click)="closeForm()">Annuler</button>
          <button type="submit">{{ editMode ? 'Modifier' : 'Créer' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
